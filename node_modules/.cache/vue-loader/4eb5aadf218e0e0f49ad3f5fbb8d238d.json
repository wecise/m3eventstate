{"remainingRequest":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/src/components/search/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/src/components/search/index.vue","mtime":1630388418954},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCAkIGZyb20gJ2pxdWVyeSc7CmltcG9ydCBldmVudCBmcm9tICcuL2V2ZW50LnZ1ZSc7CmltcG9ydCBjaGFuZ2UgZnJvbSAnLi9jaGFuZ2UudnVlJzsKaW1wb3J0IGVudGl0eSBmcm9tICcuL2VudGl0eS52dWUnOwppbXBvcnQgZmlsZSBmcm9tICcuL2ZpbGUudnVlJzsKaW1wb3J0IHBlcmYgZnJvbSAnLi9wZXJmLnZ1ZSc7CmltcG9ydCBsb2dzIGZyb20gJy4vbG9ncy52dWUnOwppbXBvcnQgdGltZWxpbmUgZnJvbSAnLi90aW1lbGluZS52dWUnOwppbXBvcnQgeyBzY3JvbGxUbyB9IGZyb20gJ3Njcm9sbC1qcyc7CgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiSW5kZXhWaWV3IiwKICAgIGNvbXBvbmVudHM6ewogICAgICAgIGV2ZW50LAogICAgICAgIGVudGl0eSwKICAgICAgICBjaGFuZ2UsCiAgICAgICAgZmlsZSwKICAgICAgICBwZXJmLAogICAgICAgIGxvZ3MsCiAgICAgICAgdGltZWxpbmUKICAgIH0sCiAgICBwcm9wczp7CiAgICAgICAgZ2xvYmFsOiBPYmplY3QKICAgIH0sCiAgICBkYXRhKCl7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc2VhcmNoOnsKICAgICAgICAgICAgICAgIHRlcm06ICIiLAogICAgICAgICAgICAgICAgY2xhc3M6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIi9tYXRyaXgvZGV2b3BzL2FsZXJ0X3N0YXR1cyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXN1bHQ6IG51bGwsCiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOnsKICAgICAgICAic2VhcmNoLnRlcm0iKHZhbCl7CiAgICAgICAgICAgIGlmKCF2YWwpewogICAgICAgICAgICAgICAgdGhpcy5vbkNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgY3JlYXRlZCgpewogICAgICAgIC8vIOWIneWni+WMlnByZXNldAogICAgICAgIC8qIHRyeXsKICAgICAgICAgICAgbGV0IHByZXNldCA9IGRlY29kZVVSSUNvbXBvbmVudCh3aW5kb3cuYXRvYih0aGlzLmdldFF1ZXJ5VmFyaWFibGUoJ3ByZXNldCcpKSk7CiAgICAgICAgICAgIF8uZXh0ZW5kKHRoaXMub3B0aW9ucyxfLmF0dGVtcHQoSlNPTi5wYXJzZS5iaW5kKG51bGwsIHByZXNldCkpKTsKICAgICAgICB9IGNhdGNoKGVycil7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICB9ICovCgogICAgICAgIGRvY3VtZW50Lm9ua2V5ZG93biA9ICgpPT4gewogICAgICAgICAgICBsZXQga2V5ID0gd2luZG93LmV2ZW50LmtleUNvZGU7CiAgICAgICAgICAgIGlmIChrZXkgPT0gMTMpIHsKICAgICAgICAgICAgICAgIHRoaXMub25TZWFyY2goKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9LAogICAgbW91bnRlZCgpewogICAgICAgIAogICAgICAgIHRoaXMud2VjbG9tZSgpOwoKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgb25TY3JvbGxUbyhuYW1lKXsKICAgICAgICAgICAgbGV0IGVsID0gdGhpcy4kcmVmc1tuYW1lXVswXS4kZWwub2Zmc2V0VG9wOwogICAgICAgICAgICBsZXQgY29udGFpbmVyID0gdGhpcy4kcmVmc1snY29udGFpbmVyJ10uJGVsOwogICAgICAgICAgICBzY3JvbGxUbyhjb250YWluZXIsIHsgdG9wOiBlbCB9KTsKICAgICAgICAgICAgCiAgICAgICAgfSwKICAgICAgICBvbkNsZWFyKCl7CiAgICAgICAgICAgIHRoaXMuc2VhcmNoLnJlc3VsdCA9IG51bGw7CiAgICAgICAgfSwKICAgICAgICBvblNlYXJjaCgpewoKICAgICAgICAgICAgaWYoXy5pc0VtcHR5KHRoaXMuc2VhcmNoLnRlcm0pKXsKICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuaW5mbygi6K+36L6T5YWl5pCc57Si5YWz6ZSu5a2XIik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc2VhcmNoLmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICBsZXQgcGFyYW0gPSBlbmNvZGVVUklDb21wb25lbnQoIEpTT04uc3RyaW5naWZ5KCB7dGVybTp0aGlzLnNlYXJjaC50ZXJtLCBwcmVzZXQ6bnVsbH0gKSApOwogICAgICAgICAgICB0aGlzLm0zLmNhbGxGUygiL21hdHJpeC9tM3NlYXJjaC9zZWFyY2hCeVRlcm0uanMiLCBwYXJhbSkudGhlbihyZXM9PnsKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoLnJlc3VsdCA9IHJlcy5tZXNzYWdlOwogICAgICAgICAgICAgICAgdGhpcy5zZWFyY2gubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KS5jYXRjaChlcnI9PnsKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGdldFF1ZXJ5VmFyaWFibGUodmFyaWFibGUpewogICAgICAgICAgICB2YXIgcXVlcnkgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgdmFyIHZhcnMgPSBxdWVyeS5zcGxpdCgiJiIpOwogICAgICAgICAgICBmb3IgKHZhciBpPTA7aTx2YXJzLmxlbmd0aDtpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGFpciA9IHZhcnNbaV0uc3BsaXQoIj0iKTsKICAgICAgICAgICAgICAgICAgICBpZihwYWlyWzBdID09IHZhcmlhYmxlKXtyZXR1cm4gcGFpclsxXTt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuKGZhbHNlKTsKICAgICAgICB9LAogICAgICAgIHdlY2xvbWUoKXsKCiAgICAgICAgICAgIHRoaXMubTMuY2FsbEZTKCIvbWF0cml4L20zc2VhcmNoL3dlY2xvbWUuanMiLG51bGwpLnRoZW4oIChydG4pPT57CiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IHJ0bi5tZXNzYWdlOwoKICAgICAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfmrKLov47kvb/nlKjkuIDplK7mkJzntKInLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gKTsKICAgICAgICB9CiAgICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/search","sourcesContent":["<template>\n    <el-container style=\"height: calc(100vh - 80px);background:#ffffff;\">\n        <el-header style=\"line-height: 60px;\">\n            <el-input placeholder=\"请输入关键字\" v-model=\"search.term\" \n                clearable\n                @clear=\"onClear\">\n                <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"onSearch\" :loading=\"search.loading\"></el-button>\n            </el-input>\n        </el-header>\n        <el-main style=\"overflow: hidden;height: 100%;padding-top:0px;\" v-if=\"search.result && search.result.all.length>0\">\n            <div style=\"width:100%;padding:10px;background:#f2f2f2;\">\n                <span>搜索结果：</span>\n                <template v-for=\"(v,k) in search.result\">\n                    <el-button type=\"default\" :key=\"k\" \n                        @click=\"onScrollTo(k)\"\n                        v-if=\"v.title && v.rows.length > 0\">\n                        {{v.title}}: {{v.rows.length}}\n                    </el-button>\n                </template>\n            </div>\n            <el-container style=\"height: 100%;\">\n                <el-main style=\"padding:0px 20px 0px 0px;height:100%;overflow:auto;\" ref=\"container\">\n                    <el-tabs value=\"view\">\n                        <el-tab-pane name=\"view\" key=\"view\">\n                            <span slot=\"label\">按分类</span>\n                            <template v-for=\"(v,k) in search.result\">\n                                <component \n                                    :ref=\"k\"\n                                    :id=\"'el-'+k\"\n                                    v-bind:is=\"k\" :global=\"global\" :dt=\"v\" \n                                    :key=\"k\" v-if=\"v.title && v.rows.length>0\"></component>\n                            </template>\n                        </el-tab-pane>\n                        <el-tab-pane name=\"timeline\" key=\"timeline\">\n                            <template slot=\"label\">时间线</template>\n                            <timeline :model=\"search.result\" :global=\"global\"></timeline>\n                        </el-tab-pane>\n                    </el-tabs> \n                    \n                </el-main>\n                \n            </el-container>\n            \n        </el-main>\n\n        <el-main style=\"background:#ffffff;\" v-else>\n                <svg-icon icon-class=\"eventList\" style=\"font-size:64px;\"/>\n                <h2>没有找到相关记录。</h2>\n                <p>\n                    温馨提示：  \n                    请检查您的输入是否正确 \n                    如有任何意见或建议，请及时反馈给我们。wj@wecise.com \n                </p>\n        </el-main>\n\n    </el-container>\n    \n</template>\n\n<script>\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport event from './event.vue';\nimport change from './change.vue';\nimport entity from './entity.vue';\nimport file from './file.vue';\nimport perf from './perf.vue';\nimport logs from './logs.vue';\nimport timeline from './timeline.vue';\nimport { scrollTo } from 'scroll-js';\n\nexport default {\n    name: \"IndexView\",\n    components:{\n        event,\n        entity,\n        change,\n        file,\n        perf,\n        logs,\n        timeline\n    },\n    props:{\n        global: Object\n    },\n    data(){\n        return {\n            search:{\n                term: \"\",\n                class: {\n                    value: \"/matrix/devops/alert_status\"\n                },\n                result: null,\n                loading: false\n            }\n        }\n    },\n    watch:{\n        \"search.term\"(val){\n            if(!val){\n                this.onClear();\n            }\n        }\n    },\n    created(){\n        // 初始化preset\n        /* try{\n            let preset = decodeURIComponent(window.atob(this.getQueryVariable('preset')));\n            _.extend(this.options,_.attempt(JSON.parse.bind(null, preset)));\n        } catch(err){\n            console.error(err);\n        } */\n\n        document.onkeydown = ()=> {\n            let key = window.event.keyCode;\n            if (key == 13) {\n                this.onSearch();\n            }\n        }\n\n    },\n    mounted(){\n        \n        this.weclome();\n\n    },\n    methods: {\n        onScrollTo(name){\n            let el = this.$refs[name][0].$el.offsetTop;\n            let container = this.$refs['container'].$el;\n            scrollTo(container, { top: el });\n            \n        },\n        onClear(){\n            this.search.result = null;\n        },\n        onSearch(){\n\n            if(_.isEmpty(this.search.term)){\n                this.$message.info(\"请输入搜索关键字\");\n                return false;\n            }\n\n            this.search.loading = true;\n            let param = encodeURIComponent( JSON.stringify( {term:this.search.term, preset:null} ) );\n            this.m3.callFS(\"/matrix/m3search/searchByTerm.js\", param).then(res=>{\n                this.search.result = res.message;\n                this.search.loading = false;\n            }).catch(err=>{\n                this.search.loading = false;\n            })\n        },\n        getQueryVariable(variable){\n            var query = window.location.search.substring(1);\n            var vars = query.split(\"&\");\n            for (var i=0;i<vars.length;i++) {\n                    var pair = vars[i].split(\"=\");\n                    if(pair[0] == variable){return pair[1];}\n            }\n            return(false);\n        },\n        weclome(){\n\n            this.m3.callFS(\"/matrix/m3search/weclome.js\",null).then( (rtn)=>{\n                let message = rtn.message;\n\n                this.$notify({\n                    title: '欢迎使用一键搜索',\n                    type: 'success',\n                    dangerouslyUseHTMLString: true,\n                    message: message\n                });\n            } );\n        }\n    }\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}