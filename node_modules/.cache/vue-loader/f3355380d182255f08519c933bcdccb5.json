{"remainingRequest":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/src/components/graph/searchbar/AdvBar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/src/components/graph/searchbar/AdvBar.vue","mtime":1629783440070},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/cnwangzd/Documents/cnwangzd/wecise/m3/apps/m3search/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCB0b2dnbGVCYXJNaXhpbiBmcm9tICcuLi8uLi9taXhpbnMvaW5kZXguanMnOwoKZXhwb3J0IGRlZmF1bHQgewogICAgbmFtZTogIkFkdkJhciIsCiAgICBtaXhpbnM6IFt0b2dnbGVCYXJNaXhpbl0sCiAgICBjb21wb25lbnRzOnsKICAgICAgICBFZGl0b3I6cmVxdWlyZSgidnVlMi1hY2UtZWRpdG9yIiksCiAgICB9LAogICAgZGF0YSgpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNvbnRyb2w6IHsKICAgICAgICAgICAgICAgIHNob3c6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2VhcmNoOiB7CiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRlcm06ICIiLAogICAgICAgICAgICAgICAgcmVzdWx0OiBudWxsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlbGVjdGVkOiBudWxsLAogICAgICAgICAgICBlZGl0b3I6IHsKICAgICAgICAgICAgICAgIGRhdGE6IG51bGwsCiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgIGxhbmc6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogInNxbCIsCiAgICAgICAgICAgICAgICAgICAgbGlzdDogW10KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0aGVtZTogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAiY2hyb21lIiwKICAgICAgICAgICAgICAgICAgICBsaXN0OiB0aGlzLm0zLkVESVRPUl9USEVNRQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIHdhdGNoOiB7CiAgICAgICAgJ3NlYXJjaC50ZXJtJzpmdW5jdGlvbih2YWwpewogICAgICAgICAgICBpZihfLmlzRW1wdHkodmFsKSl7CiAgICAgICAgICAgICAgICB0aGlzLm9uQ2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBjb21wdXRlZDp7CiAgICAgICAgY29udHJvbFN0YXR1cygpewogICAgICAgICAgICBpZih0aGlzLmNvbnRyb2wuc2hvdyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJ2VsLWljb24tYXJyb3ctbGVmdCc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJ2VsLWljb24tYXJyb3ctcmlnaHQnOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZWFyY2hSZXN1bHRTdGF0dXMoKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udHJvbC5zaG93ICYmIHRoaXMuZW50aXR5LnNlYXJjaC5yZXN1bHQgJiYgdGhpcy5lbnRpdHkuc2VhcmNoLnJlc3VsdC5sZW5ndGggPiAwOwogICAgICAgIH0KICAgIH0sCiAgICBmaWx0ZXJzOiB7CiAgICAgICAgcGlja0ljb24oaXRlbSl7CiAgICAgICAgICAgIGxldCBpY29uID0gaXRlbS5pY29uOwogICAgICAgICAgICByZXR1cm4gYC9zdGF0aWMvYXNzZXRzL2ltYWdlcy9lbnRpdHkvcG5nLyR7aWNvbn0ucG5nYDsKICAgICAgICB9CiAgICB9LAogICAgY3JlYXRlZCgpewogICAgICAgIHRoaXMub25Mb2FkSGlzdG9yeSgpOwogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBvblRvZ2dsZUJhcigpewogICAgICAgICAgICB0aGlzLmNvbnRyb2wuc2hvdyA9ICF0aGlzLmNvbnRyb2wuc2hvdzsgCiAgICAgICAgfSwKICAgICAgICBvbkVkaXRvckluaXQoKXsKICAgICAgICAgICAgcmVxdWlyZSgiYnJhY2UvZXh0L2xhbmd1YWdlX3Rvb2xzIik7IC8vbGFuZ3VhZ2UgZXh0ZW5zaW9uIHByZXJlcXVzaXRlLi4uCiAgICAgICAgICAgIHJlcXVpcmUoYGJyYWNlL21vZGUvJHt0aGlzLmVkaXRvci5sYW5nLnZhbHVlfWApOyAvL2xhbmd1YWdlCiAgICAgICAgICAgIHJlcXVpcmUoYGJyYWNlL3NuaXBwZXRzLyR7dGhpcy5lZGl0b3IubGFuZy52YWx1ZX1gKTsgLy9zbmlwcGV0CiAgICAgICAgICAgIHJlcXVpcmUoYGJyYWNlL3RoZW1lLyR7dGhpcy5lZGl0b3IudGhlbWUudmFsdWV9YCk7IC8vbGFuZ3VhZ2UKCiAgICAgICAgICAgIGxldCBlZGl0b3IgPSB0aGlzLiRyZWZzLmVkaXRvclJlZi5lZGl0b3I7CiAgICAgICAgICAgIGVkaXRvci5vbignY2hhbmdlJywgXy5kZWJvdW5jZSgoKT0+IHsKICAgICAgICAgICAgICAgIHRoaXMub25TYXZlQXNIaXN0b3J5KCk7CiAgICAgICAgICAgIH0pLDEwMDApOwoKICAgICAgICB9LAogICAgICAgIG9uTG9hZEhpc3RvcnkoKXsKICAgICAgICAgICAgbGV0IHBhcmFtID0gZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KHthY3Rpb246J2xvYWQnLHZhbHVlOm51bGx9KSk7CiAgICAgICAgICAgIHRoaXMubTMuY2FsbEZTKCIvbWF0cml4L20zZ3JhcGgvaGlzdG9yeS5qcyIsIHBhcmFtKS50aGVuKHJlcz0+ewogICAgICAgICAgICAgICAgdGhpcy5lZGl0b3IuZGF0YSA9IHJlcy5tZXNzYWdlOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgb25TYXZlQXNIaXN0b3J5KCl7CiAgICAgICAgICAgIGxldCBwYXJhbSA9IGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeSh7YWN0aW9uOidzYXZlJyx2YWx1ZTogdGhpcy5lZGl0b3IuZGF0YX0pKTsKICAgICAgICAgICAgdGhpcy5tMy5jYWxsRlMoIi9tYXRyaXgvbTNncmFwaC9oaXN0b3J5LmpzIiwgcGFyYW0pLnRoZW4ocmVzPT57CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBvbkVudGl0eVRyZWVTZWxlY3RlZChkYXRhKXsKICAgICAgICAgICAgdGhpcy5zZWFyY2gudGVybSA9IGRhdGEuYWxpYXM7CiAgICAgICAgICAgIHRoaXMub25TZWFyY2goKTsKICAgICAgICB9LAogICAgICAgIG9uQ2xlYXIoKXsKICAgICAgICAgICAgdGhpcy5zZWFyY2guc2VsZWN0ZWQgPSBudWxsOwogICAgICAgICAgICB0aGlzLnNlYXJjaC5yZXN1bHQgPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgb25TZWFyY2goKSB7CgogICAgICAgICAgICBsZXQgZWRpdG9yID0gdGhpcy4kcmVmcy5lZGl0b3JSZWYuZWRpdG9yOwogICAgICAgICAgICB0aGlzLnNlYXJjaC50ZXJtID0gZWRpdG9yLmdldFNlbGVjdGVkVGV4dCgpIHx8IGVkaXRvci5nZXRWYWx1ZSgpOwoKICAgICAgICAgICAgdGhpcy5zZWFyY2gubG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihfLmlzRW1wdHkodGhpcy5zZWFyY2gudGVybSkpewogICAgICAgICAgICAgICAgdGhpcy5zZWFyY2gubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLm0zLmNhbGxGUygiL21hdHJpeC9tM2dyYXBoL2dyYXBoU2VydmljZS5qcyIsIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnNlYXJjaC50ZXJtKSkudGhlbiggcmVzPT57CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgiZ3JhcGgtZGF0YSIscmVzLm1lc3NhZ2VbMF0uZ3JhcGgpOwoKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoLmxvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2wuc2hvdyA9IGZhbHNlOwoKICAgICAgICAgICAgfSkuY2F0Y2goKCk9PnsKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["AdvBar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"AdvBar.vue","sourceRoot":"src/components/graph/searchbar","sourcesContent":["<template>\n    <el-container class=\"adv-bar\">\n        <el-header style=\"display:flex;height:35px;line-height:35px;padding:0px;\">\n            <el-button type=\"text\" :icon=\"controlStatus\" @click=\"control.show=!control.show\"></el-button>\n            <template v-if=\"control.show\">\n                <el-input placeholder=\"搜索实体、活动关键字\" class=\"input\" disabled></el-input>\n                <el-button type=\"text\" @click=\"$emit('toggle-view','SearchBar')\">\n                    <span class=\"el-icon-close\" style=\"font-size:14px;font-weight: 900;\"></span>\n                </el-button>\n                <el-button type=\"success\" class=\"search\" :loading=\"search.loading\" @click=\"onSearch\">\n                    <span class=\"el-icon-search\"></span>\n                </el-button>\n            </template>\n        </el-header>\n        <el-main class=\"adv-main\" v-show=\"control.show\">\n            <Editor\n                v-model=\"editor.data\"\n                @init=\"onEditorInit\"\n                :lang=\"editor.lang.value\"\n                :theme=\"editor.theme.value\"\n                width=\"100%\"\n                height=\"100%\"\n                ref=\"editorRef\">\n            </Editor>\n        </el-main>\n    </el-container>\n</template>\n\n<script>\nimport _ from 'lodash';\nimport toggleBarMixin from '../../mixins/index.js';\n\nexport default {\n    name: \"AdvBar\",\n    mixins: [toggleBarMixin],\n    components:{\n        Editor:require(\"vue2-ace-editor\"),\n    },\n    data(){\n        return {\n            control: {\n                show: true\n            },\n            search: {\n                loading: false,\n                term: \"\",\n                result: null\n            },\n            selected: null,\n            editor: {\n                data: null,\n                loading: false,\n                lang: {\n                    value: \"sql\",\n                    list: []\n                },\n                theme: {\n                    value: \"chrome\",\n                    list: this.m3.EDITOR_THEME\n                }\n            }\n        }\n    },\n    watch: {\n        'search.term':function(val){\n            if(_.isEmpty(val)){\n                this.onClear();\n            }\n        }\n    },\n    computed:{\n        controlStatus(){\n            if(this.control.show){\n                return 'el-icon-arrow-left';\n            } else {\n                return 'el-icon-arrow-right';\n            }\n        },\n        searchResultStatus(){\n            return this.control.show && this.entity.search.result && this.entity.search.result.length > 0;\n        }\n    },\n    filters: {\n        pickIcon(item){\n            let icon = item.icon;\n            return `/static/assets/images/entity/png/${icon}.png`;\n        }\n    },\n    created(){\n        this.onLoadHistory();\n    },\n    methods: {\n        onToggleBar(){\n            this.control.show = !this.control.show; \n        },\n        onEditorInit(){\n            require(\"brace/ext/language_tools\"); //language extension prerequsite...\n            require(`brace/mode/${this.editor.lang.value}`); //language\n            require(`brace/snippets/${this.editor.lang.value}`); //snippet\n            require(`brace/theme/${this.editor.theme.value}`); //language\n\n            let editor = this.$refs.editorRef.editor;\n            editor.on('change', _.debounce(()=> {\n                this.onSaveAsHistory();\n            }),1000);\n\n        },\n        onLoadHistory(){\n            let param = encodeURIComponent(JSON.stringify({action:'load',value:null}));\n            this.m3.callFS(\"/matrix/m3graph/history.js\", param).then(res=>{\n                this.editor.data = res.message;\n            })\n        },\n        onSaveAsHistory(){\n            let param = encodeURIComponent(JSON.stringify({action:'save',value: this.editor.data}));\n            this.m3.callFS(\"/matrix/m3graph/history.js\", param).then(res=>{\n                console.log(res)\n            })\n        },\n        onEntityTreeSelected(data){\n            this.search.term = data.alias;\n            this.onSearch();\n        },\n        onClear(){\n            this.search.selected = null;\n            this.search.result = null;\n        },\n        onSearch() {\n\n            let editor = this.$refs.editorRef.editor;\n            this.search.term = editor.getSelectedText() || editor.getValue();\n\n            this.search.loading = true;\n            \n            if(_.isEmpty(this.search.term)){\n                this.search.loading = false;\n                return false;\n            }\n\n            this.m3.callFS(\"/matrix/m3graph/graphService.js\", encodeURIComponent(this.search.term)).then( res=>{\n            \n                this.$emit(\"graph-data\",res.message[0].graph);\n\n                this.search.loading = false;\n\n                this.control.show = false;\n\n            }).catch(()=>{\n                this.search.loading = false;\n            });\n            \n        }\n    }\n}\n</script>\n\n<style scoped>\n    .adv-bar.el-container{\n        position: absolute;\n        left: 10px;\n        top: 10px;\n        z-index: 1000;\n        background: #f2f2f2;\n    }\n    .adv-bar .el-header{\n        text-align: center;\n        border: 1px solid #f2f2f2;\n    }\n    .adv-bar .el-button+.el-button {\n        margin-left: 0px;\n    }\n    .adv-bar .el-button{\n        color: #777777;\n        width: 50px;\n        border-radius: 0px!important;\n    }\n\n    .adv-bar .input{\n        width: auto;\n        min-width: 83vw;\n    }\n\n    .adv-bar .search span{\n        color: #ffffff;\n    }\n\n    .adv-bar .el-divider__text {\n        background-color: transparent;\n        color: #777777;\n    }\n\n    .adv-bar .adv-main{\n        width:100%;\n        height:30vh;\n        border-top:1px solid #409EFF;\n    }\n</style>\n<style>\n    .adv-bar .el-input-group__append, .el-input-group__prepend{\n        border: unset!important;\n    }\n    .adv-bar .el-input--mini .el-input__inner {\n        height: 33px!important;\n        line-height: 33px!important;\n        border: transparent!important;\n        background: transparent!important;\n        border-radius: 0px!important;\n    }\n</style>"]}]}